<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragones & Camejos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="icon" href="../assets/favicon.png" type="image/png">
        <img src="../assets/dragon.png" class="rounded float-end" width="50" right="10" alt="No cargo la imagen">
</head>

<body data-bs-theme="dark">
    <div class="container">
        <div class="row">
            <div class="col">
                <h1>Dragones & Camejos</h1>
                <h5 id="tu_comida">Tu comida: </h5>
                <a href="crear_dragon/" class="btn btn-primary mb-3" style="width: 70%;">Crear Dragon</a>
                <a class="btn btn-secondary mb-3" href="../" style="width: 29%;">Volver</a>
            </div>
        </div>
    </div>

    <div class="container text-center">
        <div class="row row-cols-auto" id="dragones">
            
        </div>
    </div>

    <script>
        
    const URL_API = "http://192.168.0.157:5000"

    function response_received(response) {
        return response.json();
    }
    function request_error(error) {
        console.log("ERROR");
        console.log(error);
    }

    function dragon_alimentado(content) {
        let dragon = content['dragon'];
        console.log(content);
        actualizar_comida();
        document.getElementById(`${dragon['id']}-hambre`).innerText = dragon['hambre'];
    }

    function alimentar(id) {
        let cantidad_comida = document.getElementById(`${id}-cantidad-comida`).value;
        fetch(`${URL_API}/alimentar/${id}?cantidad_comida=${cantidad_comida}`, {method: "PUT"})
            .then(response_received)
            .then(dragon_alimentado)
            .catch(request_error)
    }

    function cargar_dragones(content) {
        dragones = content['dragones'];
        let div_dragones = document.getElementById("dragones");

        dragones.forEach(dragon => {
            
            let imagen_dragon =  `../assets/${dragon['tipo_dragon']}.png`

            let div_dragon = document.createElement("div")
            div_dragon.setAttribute("class", "border rounded py-3 px-4 mb-2 mx-1");
            let color;
                switch (dragon['tipo_dragon']) {
                        case 'agua':
                            color = '#26caff';
                            break;
                        case 'fuego':
                            color = 'lightcoral';
                            break;
                        case 'metal':
                            color = 'lightgray';
                            break;
                        case 'aire':
                            color = 'white';
                            break;
                        case 'tierra':
                            color = 'burlywood';
                            break;
                        default:
                            color = 'white';
                    }
                div_dragon.setAttribute("style", "background:" + color);
            div_dragon.innerHTML = `
                <div id="${dragon['id']}" class="col">
                    <div class="row">
                        <img class="img-thumbnail mx-auto" src="../assets/${dragon['tipo_dragon']}.png" style="max-width: 200px; max-height: 200px;">
                    </div>
                    <div class="row">
                        <h5 class="mt-2">${dragon['nombre']}</h5>
                    </div>

                    <div class="row">
                        <div class="col">
                            <h5>Tipo</h5>
                        </div>
                        <div class="col">
                            <h5>${dragon['tipo_dragon'].charAt(0).toUpperCase() + dragon['tipo_dragon'].slice(1)}</h5>
                        </div>
                    </div>
                        
                    <div class="row">
                            <div class="col">
                                <h5>Hambre</h5>
                            </div>
                            <div class="col">
                                <h5 id="${dragon['id']}-hambre">${dragon['hambre']}</h5>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <h5>Salud</h5>
                            </div>
                            <div class="col">
                                <h5>${dragon['salud']}</h5>
                            </div>
                        </div>
                        <div class="row">
                        </div>
                        <div class="row mb-1">
                            <input id="${dragon['id']}-cantidad-comida" type="number" id="typeNumber" class="form-control py-3"/>
                        </div>
                        <div class="row">
                            <button class="btn btn-success d-block py-3" onclick="alimentar(${dragon['id']})">Alimentar</button>
                        </div>
                    </div>
            `;
            div_dragones.appendChild(div_dragon);
    });
    }

    function cargar_comida(content) {
        cantidad_comida = content['comida'];

        h5_comida = document.getElementById("tu_comida");
        h5_comida.innerText = `Tu comida: ${cantidad_comida}`;
    }

    function actualizar_comida() {
        fetch(`${URL_API}/almacen`)
            .then(response_received)
            .then(cargar_comida)
            .catch(request_error)
    }

    fetch(`${URL_API}/dragones`)
        .then(response_received)
        .then(cargar_dragones)
        .catch(request_error)

    actualizar_comida()

    </script>
</body>

</html>
